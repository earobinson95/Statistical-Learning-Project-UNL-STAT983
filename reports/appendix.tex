\clearpage



\begin{appendix}
\clearpage
\appendix

\hypertarget{classification-tuning}{%
\section{\texorpdfstring{Classification Tuning
\label{app:tuning}}{Classification Tuning }}\label{classification-tuning}}

\hypertarget{xgboost}{%
\subsection{\texorpdfstring{XGBoost
\label{app:xgb-tuning}}{XGBoost }}\label{xgboost}}

\begin{center}\includegraphics{final-report_files/figure-latex/xgb-tuning-1} \end{center}

\hypertarget{random-forest}{%
\subsection{\texorpdfstring{Random Forest
\label{app:rf-tuning}}{Random Forest }}\label{random-forest}}

\begin{center}\includegraphics{final-report_files/figure-latex/rf-tuning-1} \end{center}

\hypertarget{code}{%
\section{\texorpdfstring{Code \label{app:code}}{Code }}\label{code}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# LOAD LIBRARIES}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(readr)}
\FunctionTok{library}\NormalTok{(xgboost)}
\FunctionTok{library}\NormalTok{(Matrix)}
\FunctionTok{library}\NormalTok{(tictoc)}
\FunctionTok{library}\NormalTok{(furrr)}
\FunctionTok{library}\NormalTok{(smotefamily)}
\CommentTok{\# IMPORT DATA, RELEVEL FACTOR COLUMNS}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{winequality }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"data/winequality{-}all.csv"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{type =} \FunctionTok{factor}\NormalTok{(type, }
    \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\StringTok{"white"}\NormalTok{)), }\AttributeTok{type01 =} \FunctionTok{as.numeric}\NormalTok{(}\FunctionTok{ifelse}\NormalTok{(type }\SpecialCharTok{==} 
    \StringTok{"white"}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{)), }\AttributeTok{qualityclass =} \FunctionTok{factor}\NormalTok{(qualityclass, }\AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Low"}\NormalTok{, }
    \StringTok{"Normal"}\NormalTok{, }\StringTok{"High"}\NormalTok{)), }\AttributeTok{under\_class =} \FunctionTok{ifelse}\NormalTok{(qualityclass }\SpecialCharTok{==} 
    \StringTok{"Normal"}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{over\_class =} \FunctionTok{ifelse}\NormalTok{(qualityclass }\SpecialCharTok{==} \StringTok{"Low"}\NormalTok{, }
    \DecValTok{0}\NormalTok{, }\FunctionTok{ifelse}\NormalTok{(qualityclass }\SpecialCharTok{==} \StringTok{"Normal"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{)))}
\FunctionTok{colnames}\NormalTok{(winequality) }\OtherTok{\textless{}{-}} \FunctionTok{make.names}\NormalTok{(}\FunctionTok{names}\NormalTok{(winequality), }\AttributeTok{unique =} \ConstantTok{TRUE}\NormalTok{)}
\FunctionTok{summary}\NormalTok{(winequality)}
\CommentTok{\# RESAMPLING FUNCTIONS}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# FUNCTION FOR UNDERSAMPLING}
\NormalTok{undersample }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(train\_df, nsample) \{}
\NormalTok{    df\_wine\_0\_ind }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(train\_df}\SpecialCharTok{$}\NormalTok{under\_class }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
\NormalTok{    df\_wine\_1\_ind }\OtherTok{\textless{}{-}} \FunctionTok{which}\NormalTok{(train\_df}\SpecialCharTok{$}\NormalTok{under\_class }\SpecialCharTok{==} \DecValTok{1}\NormalTok{)}
\NormalTok{    pick\_0 }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(df\_wine\_0\_ind, nsample)}
\NormalTok{    undersample\_wine }\OtherTok{\textless{}{-}}\NormalTok{ train\_df[}\FunctionTok{c}\NormalTok{(df\_wine\_1\_ind, pick\_0), ]  }\CommentTok{\#Final Data frame}
\NormalTok{    undersample\_wine }\OtherTok{\textless{}{-}}\NormalTok{ undersample\_wine }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(qualityclass, }
\NormalTok{        type, fixed.acidity, volatile.acidity, citric.acid, residual.sugar, }
\NormalTok{        chlorides, free.sulfur.dioxide, total.sulfur.dioxide, }
\NormalTok{        density, pH, sulphates, alcohol)}
    \CommentTok{\# table(undersample\_wine$under\_class) \# have just to make}
    \CommentTok{\# sure it\textquotesingle{}s all balancing out how I think}
    \FunctionTok{return}\NormalTok{(undersample\_wine)}
\NormalTok{\}}
\CommentTok{\# FUNCTION FOR OVERSAMPLING}
\NormalTok{oversample }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(train\_df, k) \{}
    
\NormalTok{    winequality\_low }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(winequality, qualityclass }\SpecialCharTok{\%in\%} 
        \FunctionTok{c}\NormalTok{(}\StringTok{"Low"}\NormalTok{))}
\NormalTok{    winequality\_normal }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(winequality, qualityclass }\SpecialCharTok{\%in\%} 
        \FunctionTok{c}\NormalTok{(}\StringTok{"Normal"}\NormalTok{))}
\NormalTok{    winequality\_high }\OtherTok{\textless{}{-}} \FunctionTok{filter}\NormalTok{(winequality, qualityclass }\SpecialCharTok{\%in\%} 
        \FunctionTok{c}\NormalTok{(}\StringTok{"High"}\NormalTok{))}
    
\NormalTok{    wine }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(}\FunctionTok{sample}\NormalTok{(}\FunctionTok{nrow}\NormalTok{(winequality\_normal), }\FunctionTok{nrow}\NormalTok{(winequality\_normal) }\SpecialCharTok{*} 
        \FloatTok{0.5}\NormalTok{))}
\NormalTok{    winequality\_norm1 }\OtherTok{\textless{}{-}}\NormalTok{ winequality\_normal[wine, ]}
\NormalTok{    winequality\_norm2 }\OtherTok{\textless{}{-}}\NormalTok{ winequality\_normal[}\SpecialCharTok{{-}}\NormalTok{wine, ]}
    
\NormalTok{    wine\_LN }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(winequality\_low, winequality\_norm1)}
\NormalTok{    wine\_HN }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(winequality\_high, winequality\_norm2)}
\NormalTok{    SMOTEData1 }\OtherTok{\textless{}{-}} \FunctionTok{SMOTE}\NormalTok{(wine\_LN[, }\FunctionTok{c}\NormalTok{(}\StringTok{"fixed.acidity"}\NormalTok{, }\StringTok{"volatile.acidity"}\NormalTok{, }
        \StringTok{"citric.acid"}\NormalTok{, }\StringTok{"residual.sugar"}\NormalTok{, }\StringTok{"chlorides"}\NormalTok{, }\StringTok{"free.sulfur.dioxide"}\NormalTok{, }
        \StringTok{"total.sulfur.dioxide"}\NormalTok{, }\StringTok{"density"}\NormalTok{, }\StringTok{"pH"}\NormalTok{, }\StringTok{"sulphates"}\NormalTok{, }
        \StringTok{"alcohol"}\NormalTok{, }\StringTok{"type01"}\NormalTok{)], wine\_LN[, }\StringTok{"over\_class"}\NormalTok{], }\AttributeTok{K =}\NormalTok{ k, }
        \AttributeTok{dup\_size =} \DecValTok{0}\NormalTok{)}
\NormalTok{    SMOTEData2 }\OtherTok{\textless{}{-}} \FunctionTok{SMOTE}\NormalTok{(wine\_HN[, }\FunctionTok{c}\NormalTok{(}\StringTok{"fixed.acidity"}\NormalTok{, }\StringTok{"volatile.acidity"}\NormalTok{, }
        \StringTok{"citric.acid"}\NormalTok{, }\StringTok{"residual.sugar"}\NormalTok{, }\StringTok{"chlorides"}\NormalTok{, }\StringTok{"free.sulfur.dioxide"}\NormalTok{, }
        \StringTok{"total.sulfur.dioxide"}\NormalTok{, }\StringTok{"density"}\NormalTok{, }\StringTok{"pH"}\NormalTok{, }\StringTok{"sulphates"}\NormalTok{, }
        \StringTok{"alcohol"}\NormalTok{, }\StringTok{"type01"}\NormalTok{)], wine\_HN[, }\StringTok{"over\_class"}\NormalTok{], }\AttributeTok{K =}\NormalTok{ k, }
        \AttributeTok{dup\_size =} \DecValTok{0}\NormalTok{)}
\NormalTok{    oversample\_df1 }\OtherTok{\textless{}{-}}\NormalTok{ SMOTEData1}\SpecialCharTok{$}\NormalTok{data  }\CommentTok{\#Final data frame}
\NormalTok{    oversample\_df2 }\OtherTok{\textless{}{-}}\NormalTok{ SMOTEData2}\SpecialCharTok{$}\NormalTok{data  }\CommentTok{\#Final data frame}
\NormalTok{    oversample\_df }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(oversample\_df1, oversample\_df2) }\SpecialCharTok{\%\textgreater{}\%} 
        \FunctionTok{mutate}\NormalTok{(}\AttributeTok{type01 =} \FunctionTok{round}\NormalTok{(type01)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{type =} \FunctionTok{as.factor}\NormalTok{(}\FunctionTok{ifelse}\NormalTok{(type01 }\SpecialCharTok{==} 
        \DecValTok{0}\NormalTok{, }\StringTok{"white"}\NormalTok{, }\StringTok{"red"}\NormalTok{)), }\AttributeTok{qualityclass =} \FunctionTok{ifelse}\NormalTok{(class }\SpecialCharTok{==} \DecValTok{0}\NormalTok{, }
        \StringTok{"Low"}\NormalTok{, }\FunctionTok{ifelse}\NormalTok{(class }\SpecialCharTok{==} \StringTok{"1"}\NormalTok{, }\StringTok{"Normal"}\NormalTok{, }\StringTok{"High"}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{qualityclass =} \FunctionTok{factor}\NormalTok{(qualityclass, }
        \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Low"}\NormalTok{, }\StringTok{"Normal"}\NormalTok{, }\StringTok{"High"}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(qualityclass, }
\NormalTok{        type, fixed.acidity, volatile.acidity, citric.acid, residual.sugar, }
\NormalTok{        chlorides, free.sulfur.dioxide, total.sulfur.dioxide, }
\NormalTok{        density, pH, sulphates, alcohol)}
    \CommentTok{\# table(oversample\_df$class) have just to make sure it\textquotesingle{}s all}
    \CommentTok{\# balancing out how I think}
    \FunctionTok{return}\NormalTok{(oversample\_df)}
\NormalTok{\}}
\CommentTok{\# XGBOOST FUNCTIONS}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\CommentTok{\# SET UP FUNCTION TO EVALUATE XGBOOST}
\NormalTok{xgbFunc }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{df =}\NormalTok{ winequality, }\AttributeTok{samplingMethod =} \StringTok{"none"}\NormalTok{, }
    \AttributeTok{nUndersample =} \DecValTok{2000}\NormalTok{, }\AttributeTok{kOversample =} \DecValTok{5}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, max.depth, }
\NormalTok{    eta, }\AttributeTok{nround =} \DecValTok{2}\NormalTok{, }\AttributeTok{nthread =} \DecValTok{2}\NormalTok{, }\AttributeTok{show.table =}\NormalTok{ F) \{}
    
    \FunctionTok{require}\NormalTok{(Matrix)}
    \FunctionTok{require}\NormalTok{(xgboost)}
    
    \CommentTok{\# set up training/testing sets}
\NormalTok{    n }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(df)}
\NormalTok{    train.index }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, n), }\FunctionTok{floor}\NormalTok{(n }\SpecialCharTok{*}\NormalTok{ trainPct), }\AttributeTok{replace =}\NormalTok{ F)}
    
    \CommentTok{\# create dgCMatrix for modeling}
    
    \CommentTok{\# training}
\NormalTok{    train.data }\OtherTok{\textless{}{-}}\NormalTok{ df[train.index, ]  }\CommentTok{\# Normal}
    
    \ControlFlowTok{if}\NormalTok{ (samplingMethod }\SpecialCharTok{==} \StringTok{"undersample"}\NormalTok{) \{}
\NormalTok{        train.data }\OtherTok{\textless{}{-}} \FunctionTok{undersample}\NormalTok{(train.data, nUndersample)  }\CommentTok{\# Undersample}
\NormalTok{    \}}
    
    \ControlFlowTok{if}\NormalTok{ (samplingMethod }\SpecialCharTok{==} \StringTok{"oversample"}\NormalTok{) \{}
\NormalTok{        train.data }\OtherTok{\textless{}{-}} \FunctionTok{oversample}\NormalTok{(train.data, kOversample)  }\CommentTok{\# Oversample}
\NormalTok{    \}}
    
\NormalTok{    train.data }\OtherTok{\textless{}{-}}\NormalTok{ train.data }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(qualityclass, }
\NormalTok{        type, fixed.acidity, volatile.acidity, citric.acid, residual.sugar, }
\NormalTok{        chlorides, free.sulfur.dioxide, total.sulfur.dioxide, }
\NormalTok{        density, pH, sulphates, alcohol)}
    
\NormalTok{    train.datamatrix }\OtherTok{\textless{}{-}} \FunctionTok{sparse.model.matrix}\NormalTok{(qualityclass }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }
        \AttributeTok{data =}\NormalTok{ train.data)[, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{    train.qualityclass }\OtherTok{\textless{}{-}}\NormalTok{ train.data}\SpecialCharTok{$}\NormalTok{qualityclass}
\NormalTok{    train.label }\OtherTok{\textless{}{-}} \FunctionTok{as.integer}\NormalTok{(train.data}\SpecialCharTok{$}\NormalTok{qualityclass) }\SpecialCharTok{{-}} \DecValTok{1}  \CommentTok{\# label conversion}
\NormalTok{    xgb.train }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{data =}\NormalTok{ train.datamatrix, }\AttributeTok{label =}\NormalTok{ train.label)}
    
    \CommentTok{\# testing}
\NormalTok{    test.data }\OtherTok{\textless{}{-}}\NormalTok{ df[}\SpecialCharTok{{-}}\NormalTok{train.index, ] }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(qualityclass, }
\NormalTok{        type, fixed.acidity, volatile.acidity, citric.acid, residual.sugar, }
\NormalTok{        chlorides, free.sulfur.dioxide, total.sulfur.dioxide, }
\NormalTok{        density, pH, sulphates, alcohol)}
\NormalTok{    test.datamatrix }\OtherTok{\textless{}{-}} \FunctionTok{sparse.model.matrix}\NormalTok{(qualityclass }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }
        \AttributeTok{data =}\NormalTok{ test.data)[, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{]}
\NormalTok{    test.qualityclass }\OtherTok{\textless{}{-}}\NormalTok{ test.data}\SpecialCharTok{$}\NormalTok{qualityclass}
\NormalTok{    test.label }\OtherTok{\textless{}{-}} \FunctionTok{as.integer}\NormalTok{(test.data}\SpecialCharTok{$}\NormalTok{qualityclass) }\SpecialCharTok{{-}} \DecValTok{1}  \CommentTok{\# label conversion}
\NormalTok{    xgb.test }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{data =}\NormalTok{ test.datamatrix, }\AttributeTok{label =}\NormalTok{ test.label)}
    
    
    \CommentTok{\# fit xgboost model}
\NormalTok{    xgb.fit }\OtherTok{\textless{}{-}} \FunctionTok{xgboost}\NormalTok{(}\AttributeTok{data =}\NormalTok{ xgb.train}\SpecialCharTok{$}\NormalTok{data, }\AttributeTok{label =}\NormalTok{ xgb.train}\SpecialCharTok{$}\NormalTok{label, }
        \AttributeTok{booster =} \StringTok{"gbtree"}\NormalTok{, }\AttributeTok{max.depth =}\NormalTok{ max.depth, }\AttributeTok{eta =}\NormalTok{ eta, }
        \AttributeTok{nround =}\NormalTok{ nround, }\AttributeTok{nthread =}\NormalTok{ nthread, }\AttributeTok{objective =} \StringTok{"multi:softprob"}\NormalTok{, }
        \AttributeTok{eval\_metric =} \StringTok{"merror"}\NormalTok{, }\AttributeTok{num\_class =} \FunctionTok{length}\NormalTok{(}\FunctionTok{levels}\NormalTok{(train.qualityclass)), }
        \AttributeTok{verbose =} \DecValTok{0}\NormalTok{)}
    
    \CommentTok{\# predict}
\NormalTok{    xgb.pred }\OtherTok{=} \FunctionTok{predict}\NormalTok{(xgb.fit, xgb.test}\SpecialCharTok{$}\NormalTok{data, }\AttributeTok{reshape =}\NormalTok{ T) }\SpecialCharTok{\%\textgreater{}\%} 
        \FunctionTok{as.data.frame}\NormalTok{()}
    \FunctionTok{colnames}\NormalTok{(xgb.pred) }\OtherTok{=} \FunctionTok{levels}\NormalTok{(train.qualityclass)}
\NormalTok{    xgb.pred}\SpecialCharTok{$}\NormalTok{prediction }\OtherTok{=} \FunctionTok{apply}\NormalTok{(xgb.pred, }\DecValTok{1}\NormalTok{, }\ControlFlowTok{function}\NormalTok{(x) }\FunctionTok{colnames}\NormalTok{(xgb.pred)[}\FunctionTok{which.max}\NormalTok{(x)])}
\NormalTok{    xgb.pred}\SpecialCharTok{$}\NormalTok{label }\OtherTok{=} \FunctionTok{levels}\NormalTok{(train.qualityclass)[test.label }\SpecialCharTok{+} 
        \DecValTok{1}\NormalTok{]}
\NormalTok{    xgb.pred }\OtherTok{\textless{}{-}}\NormalTok{ xgb.pred }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{prediction =} \FunctionTok{factor}\NormalTok{(prediction, }
        \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Low"}\NormalTok{, }\StringTok{"Normal"}\NormalTok{, }\StringTok{"High"}\NormalTok{)), }\AttributeTok{label =} \FunctionTok{factor}\NormalTok{(label, }
        \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Low"}\NormalTok{, }\StringTok{"Normal"}\NormalTok{, }\StringTok{"High"}\NormalTok{)))}
    \CommentTok{\# evaluated prediction}
\NormalTok{    accuracy.all }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(xgb.pred}\SpecialCharTok{$}\NormalTok{prediction }\SpecialCharTok{==}\NormalTok{ xgb.pred}\SpecialCharTok{$}\NormalTok{label)}
\NormalTok{    table }\OtherTok{\textless{}{-}} \FunctionTok{with}\NormalTok{(xgb.pred, }\FunctionTok{table}\NormalTok{(label, prediction))}
\NormalTok{    prop.table }\OtherTok{\textless{}{-}}\NormalTok{ table}\SpecialCharTok{/}\FunctionTok{rowSums}\NormalTok{(table)}
\NormalTok{    accuracy.low }\OtherTok{\textless{}{-}}\NormalTok{ prop.table[}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{]}
\NormalTok{    accuracy.normal }\OtherTok{\textless{}{-}}\NormalTok{ prop.table[}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{]}
\NormalTok{    accuracy.high }\OtherTok{\textless{}{-}}\NormalTok{ prop.table[}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{]}
\NormalTok{    accuracy }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(accuracy.all, accuracy.low, accuracy.normal, }
\NormalTok{        accuracy.high)}
    
    \ControlFlowTok{if}\NormalTok{ (show.table) \{}
        \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{accuracy =}\NormalTok{ accuracy, }\AttributeTok{table =}\NormalTok{ table, }\AttributeTok{prop.table =}\NormalTok{ prop.table))}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
        \FunctionTok{return}\NormalTok{(accuracy)}
\NormalTok{    \}}
    
\NormalTok{\}}
\CommentTok{\# XGBOOST MCMC FUNCTION WITH PARALLEL COMPUTING}
\NormalTok{xgbMCMC }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{samplingMethod =} \StringTok{"none"}\NormalTok{, }\AttributeTok{nUndersample =} \DecValTok{2000}\NormalTok{, }
    \AttributeTok{kOversample =} \DecValTok{5}\NormalTok{, }\AttributeTok{B =} \DecValTok{5}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, max.depth, eta, }\AttributeTok{nround =} \DecValTok{2}\NormalTok{, }
    \AttributeTok{nthread =} \DecValTok{2}\NormalTok{) \{}
    \FunctionTok{require}\NormalTok{(furrr)}
    
    \CommentTok{\# Create Parameter Grid}
\NormalTok{    mcmc.grid }\OtherTok{\textless{}{-}} \FunctionTok{expand\_grid}\NormalTok{(}\AttributeTok{B =} \FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, B), }\AttributeTok{samplingMethod =}\NormalTok{ samplingMethod, }
        \AttributeTok{nUndersample =}\NormalTok{ nUndersample, }\AttributeTok{kOversample =}\NormalTok{ kOversample, }
        \AttributeTok{trainPct =}\NormalTok{ trainPct, }\AttributeTok{max.depth =}\NormalTok{ max.depth, }\AttributeTok{eta =}\NormalTok{ eta, }
        \AttributeTok{nround =}\NormalTok{ nround, }\AttributeTok{nthread =}\NormalTok{ nthread)}
    
    \CommentTok{\# Obtain Accuracy}
\NormalTok{    accuracyList }\OtherTok{\textless{}{-}}\NormalTok{ furrr}\SpecialCharTok{::}\FunctionTok{future\_pmap}\NormalTok{(mcmc.grid[, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{], xgbFunc)}
\NormalTok{    xgbAccuracy }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(accuracyList, }\AttributeTok{use.names =} \ConstantTok{TRUE}\NormalTok{), }
        \AttributeTok{ncol =} \DecValTok{4}\NormalTok{, }\AttributeTok{nrow =} \FunctionTok{nrow}\NormalTok{(mcmc.grid), }\AttributeTok{byrow =}\NormalTok{ T)}
    \FunctionTok{colnames}\NormalTok{(xgbAccuracy) }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(accuracyList[[}\DecValTok{1}\NormalTok{]])}
    
    \CommentTok{\# Summarize Accuracy}
\NormalTok{    results }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(mcmc.grid, xgbAccuracy) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \FunctionTok{c}\NormalTok{(}\StringTok{"accuracy.all"}\NormalTok{, }
        \StringTok{"accuracy.low"}\NormalTok{, }\StringTok{"accuracy.normal"}\NormalTok{, }\StringTok{"accuracy.high"}\NormalTok{), }
        \AttributeTok{names\_to =} \StringTok{"accuracyGroup"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"accuracy"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
        \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Method =} \StringTok{"XGBoost"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(Method, }
\NormalTok{        accuracyGroup, samplingMethod, nUndersample, kOversample, }
\NormalTok{        max.depth, eta, nround, nthread) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\AttributeTok{B =} \FunctionTok{n}\NormalTok{(), }
        \AttributeTok{mean =} \FunctionTok{mean}\NormalTok{(accuracy), }\AttributeTok{lower =} \FunctionTok{quantile}\NormalTok{(accuracy, }\AttributeTok{probs =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.05}\NormalTok{)), }
        \AttributeTok{upper =} \FunctionTok{quantile}\NormalTok{(accuracy, }\AttributeTok{probs =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.95}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ungroup}\NormalTok{()}
    
    \FunctionTok{return}\NormalTok{(results)}
    
\NormalTok{\}}
\CommentTok{\# RANDOM FOREST FUNCTIONS}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} SET UP FUNCTION}
\CommentTok{\# TO EVALUATE RANDOM FOREST}
\NormalTok{rfFunc }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{df =}\NormalTok{ winequality, }\AttributeTok{samplingMethod =} \StringTok{"none"}\NormalTok{, }
    \AttributeTok{nUndersample =} \DecValTok{2000}\NormalTok{, }\AttributeTok{kOversample =} \DecValTok{5}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{importance =}\NormalTok{ F, }
    \AttributeTok{mtry =} \DecValTok{4}\NormalTok{, }\AttributeTok{ntree =} \DecValTok{500}\NormalTok{, }\AttributeTok{show.table =}\NormalTok{ F) \{}
    
    \FunctionTok{require}\NormalTok{(randomForest)}
    
    \CommentTok{\# set up training/testing sets}
\NormalTok{    n }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(df)}
\NormalTok{    train.index }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, n), }\FunctionTok{floor}\NormalTok{(n }\SpecialCharTok{*}\NormalTok{ trainPct), }\AttributeTok{replace =}\NormalTok{ F)}
    
    \CommentTok{\# training}
\NormalTok{    train.data }\OtherTok{\textless{}{-}}\NormalTok{ df[train.index, ]  }\CommentTok{\# Normal}
    
    \ControlFlowTok{if}\NormalTok{ (samplingMethod }\SpecialCharTok{==} \StringTok{"undersample"}\NormalTok{) \{}
\NormalTok{        train.data }\OtherTok{\textless{}{-}} \FunctionTok{undersample}\NormalTok{(train.data, nUndersample)}
\NormalTok{    \}}
    
    \ControlFlowTok{if}\NormalTok{ (samplingMethod }\SpecialCharTok{==} \StringTok{"oversample"}\NormalTok{) \{}
\NormalTok{        train.data }\OtherTok{\textless{}{-}} \FunctionTok{oversample}\NormalTok{(train.data, kOversample)}
\NormalTok{    \}}
    
\NormalTok{    train.data }\OtherTok{\textless{}{-}}\NormalTok{ train.data }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(qualityclass, }
\NormalTok{        type, fixed.acidity, volatile.acidity, citric.acid, residual.sugar, }
\NormalTok{        chlorides, free.sulfur.dioxide, total.sulfur.dioxide, }
\NormalTok{        density, pH, sulphates, alcohol)}
    
    \CommentTok{\# testing}
\NormalTok{    test.data }\OtherTok{\textless{}{-}}\NormalTok{ df[}\SpecialCharTok{{-}}\NormalTok{train.index, ] }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(qualityclass, }
\NormalTok{        type, fixed.acidity, volatile.acidity, citric.acid, residual.sugar, }
\NormalTok{        chlorides, free.sulfur.dioxide, total.sulfur.dioxide, }
\NormalTok{        density, pH, sulphates, alcohol)}
    
    \CommentTok{\# Fit that Random Forest!}
\NormalTok{    rf.fit }\OtherTok{\textless{}{-}} \FunctionTok{randomForest}\NormalTok{(qualityclass }\SpecialCharTok{\textasciitilde{}}\NormalTok{ ., }\AttributeTok{data =}\NormalTok{ train.data, }
        \AttributeTok{method =} \StringTok{"class"}\NormalTok{, }\AttributeTok{ntree =}\NormalTok{ ntree, }\AttributeTok{mtry =}\NormalTok{ mtry, }\AttributeTok{importance =}\NormalTok{ importance)}
    
    \CommentTok{\# Get that Prediction!}
\NormalTok{    rf.pred }\OtherTok{=} \FunctionTok{predict}\NormalTok{(rf.fit, }\AttributeTok{newdata =}\NormalTok{ test.data)}
    
    \CommentTok{\# Evaluate Prediction}
\NormalTok{    accuracy.all }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(rf.pred }\SpecialCharTok{==}\NormalTok{ test.data}\SpecialCharTok{$}\NormalTok{qualityclass)  }\CommentTok{\#this is not working SJA}
\NormalTok{    table }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(test.data}\SpecialCharTok{$}\NormalTok{qualityclass, rf.pred)}
\NormalTok{    prop.table }\OtherTok{\textless{}{-}}\NormalTok{ table}\SpecialCharTok{/}\FunctionTok{rowSums}\NormalTok{(table)}
\NormalTok{    accuracy.low }\OtherTok{\textless{}{-}}\NormalTok{ prop.table[}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{]}
\NormalTok{    accuracy.normal }\OtherTok{\textless{}{-}}\NormalTok{ prop.table[}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{]}
\NormalTok{    accuracy.high }\OtherTok{\textless{}{-}}\NormalTok{ prop.table[}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{]}
\NormalTok{    accuracy }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(accuracy.all, accuracy.low, accuracy.normal, }
\NormalTok{        accuracy.high)}
    
    \ControlFlowTok{if}\NormalTok{ (show.table) \{}
        \FunctionTok{return}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{accuracy =}\NormalTok{ accuracy, }\AttributeTok{table =}\NormalTok{ table, }\AttributeTok{prop.table =}\NormalTok{ prop.table))}
\NormalTok{    \} }\ControlFlowTok{else}\NormalTok{ \{}
        \FunctionTok{return}\NormalTok{(accuracy)}
\NormalTok{    \}}
    
\NormalTok{\}}
\CommentTok{\# RANDOM FOREST MCMC FUNCTION WITH PARALLEL COMPUTING}
\NormalTok{rfMCMC }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(}\AttributeTok{B =} \DecValTok{5}\NormalTok{, }\AttributeTok{samplingMethod =} \StringTok{"none"}\NormalTok{, }\AttributeTok{nUndersample =} \DecValTok{2000}\NormalTok{, }
    \AttributeTok{kOversample =} \DecValTok{5}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{ntree =} \DecValTok{500}\NormalTok{, }\AttributeTok{mtry =} \DecValTok{4}\NormalTok{) \{}
    \FunctionTok{require}\NormalTok{(furrr)}
    
    \CommentTok{\# Create Parameter Grid}
\NormalTok{    mcmc.grid }\OtherTok{\textless{}{-}} \FunctionTok{expand\_grid}\NormalTok{(}\AttributeTok{B =} \FunctionTok{seq}\NormalTok{(}\DecValTok{1}\NormalTok{, B), }\AttributeTok{samplingMethod =}\NormalTok{ samplingMethod, }
        \AttributeTok{nUndersample =}\NormalTok{ nUndersample, }\AttributeTok{kOversample =}\NormalTok{ kOversample, }
        \AttributeTok{trainPct =}\NormalTok{ trainPct, }\AttributeTok{ntree =}\NormalTok{ ntree, }\AttributeTok{mtry =}\NormalTok{ mtry)}
    
    \CommentTok{\# Obtain Accuracy}
\NormalTok{    accuracyList }\OtherTok{\textless{}{-}}\NormalTok{ furrr}\SpecialCharTok{::}\FunctionTok{future\_pmap}\NormalTok{(mcmc.grid[, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{], rfFunc)}
\NormalTok{    rfAccuracy }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\FunctionTok{unlist}\NormalTok{(accuracyList, }\AttributeTok{use.names =} \ConstantTok{TRUE}\NormalTok{), }
        \AttributeTok{ncol =} \DecValTok{4}\NormalTok{, }\AttributeTok{nrow =} \FunctionTok{nrow}\NormalTok{(mcmc.grid), }\AttributeTok{byrow =}\NormalTok{ T)}
    \FunctionTok{colnames}\NormalTok{(rfAccuracy) }\OtherTok{\textless{}{-}} \FunctionTok{colnames}\NormalTok{(accuracyList[[}\DecValTok{1}\NormalTok{]])}
    
    \CommentTok{\# Summarize Accuracy}
\NormalTok{    results }\OtherTok{\textless{}{-}} \FunctionTok{cbind}\NormalTok{(mcmc.grid, rfAccuracy) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pivot\_longer}\NormalTok{(}\AttributeTok{cols =} \FunctionTok{c}\NormalTok{(}\StringTok{"accuracy.all"}\NormalTok{, }
        \StringTok{"accuracy.low"}\NormalTok{, }\StringTok{"accuracy.normal"}\NormalTok{, }\StringTok{"accuracy.high"}\NormalTok{), }
        \AttributeTok{names\_to =} \StringTok{"accuracyGroup"}\NormalTok{, }\AttributeTok{values\_to =} \StringTok{"accuracy"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
        \FunctionTok{mutate}\NormalTok{(}\AttributeTok{Method =} \StringTok{"Random Forest"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(Method, }
\NormalTok{        accuracyGroup, samplingMethod, nUndersample, kOversample, }
\NormalTok{        ntree, mtry) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}\AttributeTok{B =} \FunctionTok{n}\NormalTok{(), }\AttributeTok{mean =} \FunctionTok{mean}\NormalTok{(accuracy), }
        \AttributeTok{lower =} \FunctionTok{quantile}\NormalTok{(accuracy, }\AttributeTok{probs =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.05}\NormalTok{)), }\AttributeTok{upper =} \FunctionTok{quantile}\NormalTok{(accuracy, }
            \AttributeTok{probs =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.95}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ungroup}\NormalTok{()}
    
    \FunctionTok{return}\NormalTok{(results)}
    
\NormalTok{\}}
\CommentTok{\# HYPERPARAMETER GRID SEARCH}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}}
\NormalTok{setB }\OtherTok{=} \DecValTok{50}
\CommentTok{\# XGBOOST}
\FunctionTok{tic}\NormalTok{()}
\NormalTok{xgbMCMC.none.gridsearch }\OtherTok{\textless{}{-}} \FunctionTok{xgbMCMC}\NormalTok{(}\AttributeTok{samplingMethod =} \StringTok{"none"}\NormalTok{, }\AttributeTok{nUndersample =} \ConstantTok{NA}\NormalTok{, }
    \AttributeTok{kOversample =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{B =}\NormalTok{ setB, }\AttributeTok{max.depth =} \FunctionTok{seq}\NormalTok{(}\DecValTok{50}\NormalTok{, }
        \DecValTok{250}\NormalTok{, }\DecValTok{50}\NormalTok{), }\AttributeTok{eta =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.05}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }\FloatTok{0.25}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.75}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\FloatTok{0.95}\NormalTok{), }
    \AttributeTok{nround =} \FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{2}\NormalTok{), }\AttributeTok{nthread =} \FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\FunctionTok{toc}\NormalTok{()}
\NormalTok{xgbMCMC.none.gridsearch }\OtherTok{\textless{}{-}}\NormalTok{ xgbMCMC.none.gridsearch }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(accuracyGroup }\SpecialCharTok{==} 
    \StringTok{"accuracy.all"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{mean)}
\NormalTok{xgbMCMC.none.gridsearch}
\CommentTok{\# write.csv(xgbMCMC.none.gridsearch, file =}
\CommentTok{\# \textquotesingle{}reports/xgbMCMC.none.gridsearch.csv\textquotesingle{}, row.names = F, na =}
\CommentTok{\# \textquotesingle{}\textquotesingle{})}
\NormalTok{xgbMCMC.none.gridsearch.plot }\OtherTok{\textless{}{-}}\NormalTok{ xgbMCMC.none.gridsearch[}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{), }
\NormalTok{    ] }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{label =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Max Depth = "}\NormalTok{, max.depth, }\StringTok{"; Eta = "}\NormalTok{, }
\NormalTok{    eta, }\StringTok{"; nround = "}\NormalTok{, nround, }\StringTok{"; nthread = "}\NormalTok{, nthread, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mean, }\AttributeTok{y =} \FunctionTok{reorder}\NormalTok{(label, mean))) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
    \FunctionTok{geom\_errorbar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{xmin =}\NormalTok{ lower, }\AttributeTok{xmax =}\NormalTok{ upper)) }\SpecialCharTok{+} \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+} 
    \FunctionTok{scale\_y\_discrete}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{scale\_x\_continuous}\NormalTok{(}\StringTok{"Overall Accuracy"}\NormalTok{, }
    \AttributeTok{labels =}\NormalTok{ scales}\SpecialCharTok{::}\NormalTok{percent) }\SpecialCharTok{+} \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"XGBoost (No resampling)"}\NormalTok{)}
\NormalTok{xgbMCMC.none.gridsearch.plot}
\FunctionTok{tic}\NormalTok{()}
\NormalTok{xgbMCMC.undersample.gridsearch }\OtherTok{\textless{}{-}} \FunctionTok{xgbMCMC}\NormalTok{(}\AttributeTok{samplingMethod =} \StringTok{"undersample"}\NormalTok{, }
    \AttributeTok{nUndersample =} \FunctionTok{seq}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\DecValTok{2000}\NormalTok{, }\DecValTok{500}\NormalTok{), }\AttributeTok{kOversample =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }
    \AttributeTok{B =}\NormalTok{ setB, }\AttributeTok{max.depth =} \FunctionTok{seq}\NormalTok{(}\DecValTok{50}\NormalTok{, }\DecValTok{250}\NormalTok{, }\DecValTok{50}\NormalTok{), }\AttributeTok{eta =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.5}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }
        \FloatTok{0.25}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.75}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\FloatTok{0.95}\NormalTok{), }\AttributeTok{nround =} \FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{2}\NormalTok{), }
    \AttributeTok{nthread =} \FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\FunctionTok{toc}\NormalTok{()}
\NormalTok{xgbMCMC.undersample.gridsearch }\OtherTok{\textless{}{-}}\NormalTok{ xgbMCMC.undersample.gridsearch }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{select}\NormalTok{(accuracyGroup }\SpecialCharTok{==} \StringTok{"accuracy.all"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{mean)}
\NormalTok{xgbMCMC.undersample.gridsearch}
\CommentTok{\# write.csv(xgbMCMC.undersample.gridsearch, file =}
\CommentTok{\# \textquotesingle{}reports/xgbMCMC.undersample.gridsearch.csv\textquotesingle{}, row.names =}
\CommentTok{\# F, na = \textquotesingle{}\textquotesingle{})}
\NormalTok{xgbMCMC.undersample.gridsearch.plot }\OtherTok{\textless{}{-}}\NormalTok{ xgbMCMC.undersample.gridsearch[}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{), }
\NormalTok{    ] }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{label =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Max Depth = "}\NormalTok{, max.depth, }\StringTok{"; Eta = "}\NormalTok{, }
\NormalTok{    eta, }\StringTok{"; nround = "}\NormalTok{, nround, }\StringTok{"; nthread = "}\NormalTok{, nthread, }\StringTok{" (N = "}\NormalTok{, }
\NormalTok{    nundersample, }\StringTok{")"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{))}
\FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mean, }\AttributeTok{y =} \FunctionTok{reorder}\NormalTok{(label, mean))) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
    \FunctionTok{geom\_errorbar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{xmin =}\NormalTok{ lower, }\AttributeTok{xmax =}\NormalTok{ upper)) }\SpecialCharTok{+} \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+} 
    \FunctionTok{scale\_y\_discrete}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{scale\_x\_continuous}\NormalTok{(}\StringTok{"Overall Accuracy"}\NormalTok{, }
    \AttributeTok{labels =}\NormalTok{ scales}\SpecialCharTok{::}\NormalTok{percent) }\SpecialCharTok{+} \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"XGBoost (Undersampling)"}\NormalTok{)}
\NormalTok{xgbMCMC.undersample.gridsearch.plot}
\FunctionTok{tic}\NormalTok{()}
\NormalTok{xgbMCMC.oversample.gridsearch }\OtherTok{\textless{}{-}} \FunctionTok{xgbMCMC}\NormalTok{(}\AttributeTok{samplingMethod =} \StringTok{"oversample"}\NormalTok{, }
    \AttributeTok{nUndersample =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{kOversample =} \FunctionTok{seq}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{2}\NormalTok{), }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }
    \AttributeTok{B =}\NormalTok{ setB, }\AttributeTok{max.depth =} \FunctionTok{seq}\NormalTok{(}\DecValTok{50}\NormalTok{, }\DecValTok{250}\NormalTok{, }\DecValTok{50}\NormalTok{), }\AttributeTok{eta =} \FunctionTok{c}\NormalTok{(}\FloatTok{0.5}\NormalTok{, }\FloatTok{0.1}\NormalTok{, }
        \FloatTok{0.25}\NormalTok{, }\FloatTok{0.5}\NormalTok{, }\FloatTok{0.75}\NormalTok{, }\FloatTok{0.9}\NormalTok{, }\FloatTok{0.95}\NormalTok{), }\AttributeTok{nround =} \FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{2}\NormalTok{), }
    \AttributeTok{nthread =} \FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\FunctionTok{toc}\NormalTok{()}
\NormalTok{xgbMCMC.oversample.gridsearch }\OtherTok{\textless{}{-}}\NormalTok{ xgbMCMC.oversample.gridsearch }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{select}\NormalTok{(accuracyGroup }\SpecialCharTok{==} \StringTok{"accuracy.all"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{mean)}
\NormalTok{xgbMCMC.oversample.gridsearch}
\CommentTok{\# write.csv(xgbMCMC.oversample.gridsearch, file =}
\CommentTok{\# \textquotesingle{}reports/xgbMCMC.oversample.gridsearch.csv\textquotesingle{}, row.names = F,}
\CommentTok{\# na = \textquotesingle{}\textquotesingle{})}
\NormalTok{xgbMCMC.oversample.gridsearch.plot }\OtherTok{\textless{}{-}}\NormalTok{ xgbMCMC.oversample.gridsearch[}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{), }
\NormalTok{    ] }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{label =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Max Depth = "}\NormalTok{, max.depth, }\StringTok{"; Eta = "}\NormalTok{, }
\NormalTok{    eta, }\StringTok{"; nround = "}\NormalTok{, nround, }\StringTok{"; nthread = "}\NormalTok{, nthread, }\StringTok{" (k = "}\NormalTok{, }
\NormalTok{    kOversample, }\StringTok{")"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{))}
\FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mean, }\AttributeTok{y =} \FunctionTok{reorder}\NormalTok{(label, mean))) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} 
    \FunctionTok{geom\_errorbar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{xmin =}\NormalTok{ lower, }\AttributeTok{xmax =}\NormalTok{ upper)) }\SpecialCharTok{+} \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+} 
    \FunctionTok{scale\_y\_discrete}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{scale\_x\_continuous}\NormalTok{(}\StringTok{"Overall Accuracy"}\NormalTok{, }
    \AttributeTok{labels =}\NormalTok{ scales}\SpecialCharTok{::}\NormalTok{percent) }\SpecialCharTok{+} \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"XGBoost (Oversampling)"}\NormalTok{)}
\NormalTok{xgbMCMC.oversample.gridsearch.plot}
\CommentTok{\# RANDOM FOREST No resampling}
\FunctionTok{tic}\NormalTok{()}
\NormalTok{rfMCMC.none.gridsearch }\OtherTok{\textless{}{-}} \FunctionTok{rfMCMC}\NormalTok{(}\AttributeTok{samplingMethod =} \StringTok{"none"}\NormalTok{, }\AttributeTok{nUndersample =} \ConstantTok{NA}\NormalTok{, }
    \AttributeTok{kOversample =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{B =}\NormalTok{ setB, }\AttributeTok{ntree =} \FunctionTok{seq}\NormalTok{(}\DecValTok{200}\NormalTok{, }
        \DecValTok{800}\NormalTok{, }\DecValTok{200}\NormalTok{), }\AttributeTok{mtry =} \FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{2}\NormalTok{)  }\CommentTok{\# Default should be 4}
\NormalTok{)}
\FunctionTok{toc}\NormalTok{()}
\NormalTok{rfMCMC.none.gridsearch }\OtherTok{\textless{}{-}}\NormalTok{ rfMCMC.none.gridsearch }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(accuracyGroup }\SpecialCharTok{==} 
    \StringTok{"accuracy.all"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{mean)}
\NormalTok{rfMCMC.none.gridsearch}
\CommentTok{\# write.csv(rfMCMC.none.gridsearch, file =}
\CommentTok{\# \textquotesingle{}reports/rfMCMC.none.gridsearch.csv\textquotesingle{}, row.names = F, na =}
\CommentTok{\# \textquotesingle{}\textquotesingle{})}
\NormalTok{rfMCMC.none.gridsearch.plot }\OtherTok{\textless{}{-}}\NormalTok{ rfMCMC.none.gridsearch[}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{), }
\NormalTok{    ] }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{label =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Ntree = "}\NormalTok{, ntree, }\StringTok{"; mtry = "}\NormalTok{, }
\NormalTok{    mtry, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mean, }\AttributeTok{y =} \FunctionTok{reorder}\NormalTok{(label, }
\NormalTok{    mean))) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{geom\_errorbar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{xmin =}\NormalTok{ lower, }
    \AttributeTok{xmax =}\NormalTok{ upper)) }\SpecialCharTok{+} \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{scale\_y\_discrete}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{scale\_x\_continuous}\NormalTok{(}\StringTok{"Overall Accuracy"}\NormalTok{, }
    \AttributeTok{labels =}\NormalTok{ scales}\SpecialCharTok{::}\NormalTok{percent) }\SpecialCharTok{+} \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Random Forest (No resampling)"}\NormalTok{)}
\NormalTok{rfMCMC.none.gridsearch.plot}
\CommentTok{\# Undersample}
\FunctionTok{tic}\NormalTok{()}
\NormalTok{rfMCMC.undersample.gridsearch }\OtherTok{\textless{}{-}} \FunctionTok{rfMCMC}\NormalTok{(}\AttributeTok{samplingMethod =} \StringTok{"undersample"}\NormalTok{, }
    \AttributeTok{nUndersample =} \FunctionTok{seq}\NormalTok{(}\DecValTok{1000}\NormalTok{, }\DecValTok{2000}\NormalTok{, }\DecValTok{500}\NormalTok{), }\AttributeTok{kOversample =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }
    \AttributeTok{B =}\NormalTok{ setB, }\AttributeTok{ntree =} \FunctionTok{seq}\NormalTok{(}\DecValTok{200}\NormalTok{, }\DecValTok{800}\NormalTok{, }\DecValTok{200}\NormalTok{), }\AttributeTok{mtry =} \FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{2}\NormalTok{)  }\CommentTok{\# Default should be 4}
\NormalTok{)}
\FunctionTok{toc}\NormalTok{()}
\NormalTok{rfMCMC.undersample.gridsearch }\OtherTok{\textless{}{-}}\NormalTok{ rfMCMC.undersample.gridsearch }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{filter}\NormalTok{(accuracyGroup }\SpecialCharTok{==} \StringTok{"accuracy.all"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{mean)}
\NormalTok{rfMCMC.undersample.gridsearch}
\CommentTok{\# write.csv(rfMCMC.undersample.gridsearch, file =}
\CommentTok{\# \textquotesingle{}reports/rfMCMC.undersample.gridsearch.csv\textquotesingle{}, row.names = F,}
\CommentTok{\# na = \textquotesingle{}\textquotesingle{})}
\NormalTok{rfMCMC.undersample.gridsearch.plot }\OtherTok{\textless{}{-}}\NormalTok{ rfMCMC.undersample.gridsearch[}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{), }
\NormalTok{    ] }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{label =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Ntree = "}\NormalTok{, ntree, }\StringTok{"; mtry = "}\NormalTok{, }
\NormalTok{    mtry, }\StringTok{" (N = "}\NormalTok{, nUndersample, }\StringTok{")"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mean, }
    \AttributeTok{y =} \FunctionTok{reorder}\NormalTok{(label, mean))) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{geom\_errorbar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{xmin =}\NormalTok{ lower, }
    \AttributeTok{xmax =}\NormalTok{ upper)) }\SpecialCharTok{+} \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{scale\_y\_discrete}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{scale\_x\_continuous}\NormalTok{(}\StringTok{"Overall Accuracy"}\NormalTok{, }
    \AttributeTok{labels =}\NormalTok{ scales}\SpecialCharTok{::}\NormalTok{percent) }\SpecialCharTok{+} \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Random Forest (Undersampling)"}\NormalTok{)}
\NormalTok{rfMCMC.undersample.gridsearch.plot}
\CommentTok{\# Oversample}
\FunctionTok{tic}\NormalTok{()}
\NormalTok{rfMCMC.oversample.gridsearch }\OtherTok{\textless{}{-}} \FunctionTok{rfMCMC}\NormalTok{(}\AttributeTok{samplingMethod =} \StringTok{"oversample"}\NormalTok{, }
    \AttributeTok{nUndersample =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{kOversample =} \FunctionTok{seq}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{2}\NormalTok{), }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }
    \AttributeTok{B =}\NormalTok{ setB, }\AttributeTok{ntree =} \FunctionTok{seq}\NormalTok{(}\DecValTok{200}\NormalTok{, }\DecValTok{800}\NormalTok{, }\DecValTok{200}\NormalTok{), }\AttributeTok{mtry =} \FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{2}\NormalTok{)  }\CommentTok{\# Default should be 4}
\NormalTok{)}
\FunctionTok{toc}\NormalTok{()}
\NormalTok{rfMCMC.oversample.gridsearch }\OtherTok{\textless{}{-}}\NormalTok{ rfMCMC.oversample.gridsearch }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{filter}\NormalTok{(accuracyGroup }\SpecialCharTok{==} \StringTok{"accuracy.all"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{arrange}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{mean)}
\NormalTok{rfMCMC.oversample.gridsearch}
\CommentTok{\# write.csv(rfMCMC.oversample.gridsearch, file =}
\CommentTok{\# \textquotesingle{}reports/rfMCMC.oversample.gridsearch.csv\textquotesingle{}, row.names = F,}
\CommentTok{\# na = \textquotesingle{}\textquotesingle{})}
\NormalTok{rfMCMC.oversample.gridsearch.plot }\OtherTok{\textless{}{-}}\NormalTok{ rfMCMC.oversample.gridsearch[}\FunctionTok{c}\NormalTok{(}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{), }
\NormalTok{    ] }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{label =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Ntree = "}\NormalTok{, ntree, }\StringTok{"; mtry = "}\NormalTok{, }
\NormalTok{    mtry, }\StringTok{" (k = "}\NormalTok{, kOversample, }\StringTok{")"}\NormalTok{, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mean, }
    \AttributeTok{y =} \FunctionTok{reorder}\NormalTok{(label, mean))) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{geom\_errorbar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{xmin =}\NormalTok{ lower, }
    \AttributeTok{xmax =}\NormalTok{ upper)) }\SpecialCharTok{+} \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{scale\_y\_discrete}\NormalTok{(}\StringTok{""}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{scale\_x\_continuous}\NormalTok{(}\StringTok{"Overall Accuracy"}\NormalTok{, }
    \AttributeTok{labels =}\NormalTok{ scales}\SpecialCharTok{::}\NormalTok{percent) }\SpecialCharTok{+} \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Random Forest (Oversampling)"}\NormalTok{)}
\NormalTok{rfMCMC.oversample.gridsearch.plot}

\CommentTok{\# FINAL RESULTS}
\CommentTok{\# {-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-}{-} XGBOOST MCMC}
\CommentTok{\# RESULTS}
\NormalTok{setB }\OtherTok{=} \DecValTok{100}
\FunctionTok{tic}\NormalTok{()}
\NormalTok{xgbMCMC.none.results }\OtherTok{\textless{}{-}} \FunctionTok{xgbMCMC}\NormalTok{(}\AttributeTok{samplingMethod =} \StringTok{"none"}\NormalTok{, }\AttributeTok{nUndersample =} \ConstantTok{NA}\NormalTok{, }
    \AttributeTok{kOversample =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{B =}\NormalTok{ setB, }\AttributeTok{max.depth =} \DecValTok{50}\NormalTok{, }
    \AttributeTok{eta =} \FloatTok{0.75}\NormalTok{, }\AttributeTok{nround =} \DecValTok{12}\NormalTok{, }\AttributeTok{nthread =} \DecValTok{8}\NormalTok{)}
\FunctionTok{toc}\NormalTok{()}
\FunctionTok{tic}\NormalTok{()}
\NormalTok{xgbMCMC.undersample.results }\OtherTok{\textless{}{-}} \FunctionTok{xgbMCMC}\NormalTok{(}\AttributeTok{samplingMethod =} \StringTok{"undersample"}\NormalTok{, }
    \AttributeTok{nUndersample =} \DecValTok{1000}\NormalTok{, }\AttributeTok{kOversample =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{B =}\NormalTok{ setB, }
    \AttributeTok{max.depth =} \DecValTok{50}\NormalTok{, }\AttributeTok{eta =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{nround =} \DecValTok{2}\NormalTok{, }\AttributeTok{nthread =} \DecValTok{2}\NormalTok{)}
\FunctionTok{toc}\NormalTok{()}
\FunctionTok{tic}\NormalTok{()}
\NormalTok{xgbMCMC.oversample.results }\OtherTok{\textless{}{-}} \FunctionTok{xgbMCMC}\NormalTok{(}\AttributeTok{samplingMethod =} \StringTok{"oversample"}\NormalTok{, }
    \AttributeTok{nUndersample =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{kOversample =} \DecValTok{3}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{B =}\NormalTok{ setB, }
    \AttributeTok{max.depth =} \DecValTok{50}\NormalTok{, }\AttributeTok{eta =} \FloatTok{0.1}\NormalTok{, }\AttributeTok{nround =} \DecValTok{2}\NormalTok{, }\AttributeTok{nthread =} \DecValTok{2}\NormalTok{)}
\FunctionTok{toc}\NormalTok{()}
\NormalTok{xgbMCMC.results }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(xgbMCMC.none.results, xgbMCMC.undersample.results, }
\NormalTok{    xgbMCMC.oversample.results) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{label =} \FunctionTok{paste}\NormalTok{(}\StringTok{"Max Depth = "}\NormalTok{, }
\NormalTok{    max.depth, }\StringTok{"; Eta = "}\NormalTok{, eta, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{max.depth, }
    \SpecialCharTok{{-}}\NormalTok{eta, }\SpecialCharTok{{-}}\NormalTok{nround, }\SpecialCharTok{{-}}\NormalTok{nthread)}
\CommentTok{\# RANDOM FORST MCMC RESULTS}
\FunctionTok{tic}\NormalTok{()}
\NormalTok{rfMCMC.none.results }\OtherTok{\textless{}{-}} \FunctionTok{rfMCMC}\NormalTok{(}\AttributeTok{B =}\NormalTok{ setB, }\AttributeTok{samplingMethod =} \StringTok{"none"}\NormalTok{, }
    \AttributeTok{nUndersample =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{kOversample =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{ntree =} \DecValTok{200}\NormalTok{, }
    \AttributeTok{mtry =} \DecValTok{2}\NormalTok{)}
\FunctionTok{toc}\NormalTok{()}
\FunctionTok{tic}\NormalTok{()}
\NormalTok{rfMCMC.undersample.results }\OtherTok{\textless{}{-}} \FunctionTok{rfMCMC}\NormalTok{(}\AttributeTok{B =}\NormalTok{ setB, }\AttributeTok{samplingMethod =} \StringTok{"undersample"}\NormalTok{, }
    \AttributeTok{nUndersample =} \DecValTok{2000}\NormalTok{, }\AttributeTok{kOversample =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{ntree =} \DecValTok{800}\NormalTok{, }
    \AttributeTok{mtry =} \DecValTok{2}\NormalTok{)}
\FunctionTok{toc}\NormalTok{()}
\FunctionTok{tic}\NormalTok{()}
\NormalTok{rfMCMC.oversample.results }\OtherTok{\textless{}{-}} \FunctionTok{rfMCMC}\NormalTok{(}\AttributeTok{B =}\NormalTok{ setB, }\AttributeTok{samplingMethod =} \StringTok{"oversample"}\NormalTok{, }
    \AttributeTok{nUndersample =} \ConstantTok{NA}\NormalTok{, }\AttributeTok{kOversample =} \DecValTok{3}\NormalTok{, }\AttributeTok{trainPct =} \FloatTok{0.7}\NormalTok{, }\AttributeTok{ntree =} \DecValTok{200}\NormalTok{, }
    \AttributeTok{mtry =} \DecValTok{3}\NormalTok{)}
\FunctionTok{toc}\NormalTok{()}
\NormalTok{rfMCMC.results }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(rfMCMC.none.results, rfMCMC.undersample.results, }
\NormalTok{    rfMCMC.oversample.results) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{label =} \FunctionTok{paste}\NormalTok{(}\StringTok{"N Trees = "}\NormalTok{, }
\NormalTok{    ntree, }\StringTok{"; Mtry = "}\NormalTok{, mtry, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{ntree, }\SpecialCharTok{{-}}\NormalTok{mtry)}
\CommentTok{\# COMBINE XGBOOST AND RANDOM FOREST RESULTS \& PLOT}
\NormalTok{MCMC.results }\OtherTok{\textless{}{-}} \FunctionTok{rbind}\NormalTok{(xgbMCMC.results, rfMCMC.results)}
\FunctionTok{write.csv}\NormalTok{(MCMC.results, }\StringTok{"reports/MCMC.results.csv"}\NormalTok{, }\AttributeTok{row.names =}\NormalTok{ F, }
    \AttributeTok{na =} \StringTok{""}\NormalTok{)}
\NormalTok{MCMC.results }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"reports/MCMC.results.csv"}\NormalTok{)}
\CommentTok{\# new facet labels}
\NormalTok{accuracyGroup.labs }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Overall"}\NormalTok{, }\StringTok{"Low Quality"}\NormalTok{, }\StringTok{"Normal Quality"}\NormalTok{, }
    \StringTok{"High Quality"}\NormalTok{)}
\FunctionTok{names}\NormalTok{(accuracyGroup.labs) }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"accuracy.all"}\NormalTok{, }\StringTok{"accuracy.low"}\NormalTok{, }
    \StringTok{"accuracy.normal"}\NormalTok{, }\StringTok{"accuracy.high"}\NormalTok{)}
\CommentTok{\# plot accuracy}
\NormalTok{MCMC.results }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{samplingMethod =} \FunctionTok{factor}\NormalTok{(samplingMethod, }
    \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"none"}\NormalTok{, }\StringTok{"undersample"}\NormalTok{, }\StringTok{"oversample"}\NormalTok{)), }\AttributeTok{accuracyGroup =} \FunctionTok{factor}\NormalTok{(accuracyGroup, }
    \AttributeTok{levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"accuracy.all"}\NormalTok{, }\StringTok{"accuracy.low"}\NormalTok{, }\StringTok{"accuracy.normal"}\NormalTok{, }
        \StringTok{"accuracy.high"}\NormalTok{))) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mean, }\AttributeTok{y =}\NormalTok{ samplingMethod, }
    \AttributeTok{group =}\NormalTok{ Method, }\AttributeTok{color =}\NormalTok{ Method)) }\SpecialCharTok{+} \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{size =} \DecValTok{1}\NormalTok{, }\AttributeTok{position =} \FunctionTok{position\_dodge}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.5}\NormalTok{)) }\SpecialCharTok{+} 
    \FunctionTok{geom\_errorbar}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{xmin =}\NormalTok{ lower, }\AttributeTok{xmax =}\NormalTok{ upper), }\AttributeTok{position =} \FunctionTok{position\_dodge}\NormalTok{(}\AttributeTok{width =} \FloatTok{0.5}\NormalTok{), }
        \AttributeTok{width =} \FloatTok{0.4}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{accuracyGroup, }\AttributeTok{ncol =} \DecValTok{1}\NormalTok{, }\AttributeTok{labeller =} \FunctionTok{labeller}\NormalTok{(}\AttributeTok{accuracyGroup =}\NormalTok{ accuracyGroup.labs)) }\SpecialCharTok{+} 
    \FunctionTok{theme\_bw}\NormalTok{() }\SpecialCharTok{+} \FunctionTok{theme}\NormalTok{(}\AttributeTok{aspect.ratio =} \FloatTok{0.2}\NormalTok{) }\SpecialCharTok{+} \FunctionTok{scale\_y\_discrete}\NormalTok{(}\StringTok{"Resampling Method"}\NormalTok{) }\SpecialCharTok{+} 
    \FunctionTok{scale\_x\_continuous}\NormalTok{(}\StringTok{"Accuracy"}\NormalTok{, }\AttributeTok{limits =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{), }\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }
        \DecValTok{1}\NormalTok{, }\FloatTok{0.2}\NormalTok{), }\AttributeTok{labels =}\NormalTok{ scales}\SpecialCharTok{::}\NormalTok{percent) }\SpecialCharTok{+} \FunctionTok{scale\_color\_brewer}\NormalTok{(}\StringTok{""}\NormalTok{, }
    \AttributeTok{palette =} \StringTok{"Paired"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}
\end{appendix}
